<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Editor</title>
    <style>
:root {
    --main-bg: #f0f0f0;
    --main-text: #333333;
    --primary: #0078d7;
    --primary-hover: #106ebe;
    --primary-active: #005a9e;
    --cat-bg: #e5f1fb;
    --cat-text: #004e8c;
    --gray: #eaeaea;
    --white: #ffffff;
    --border-color: #cccccc;
    --border-light: #e5e5e5;
    --border-dark: #ababab;
    --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    --font-main: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
    --radius: 4px;
    --aero-glass: rgba(255, 255, 255, 0.4);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html, body {
    height: 100%;
    color: var(--main-text);
    font-family: var(--font-main);
    font-size: 14px;
    line-height: 1.5;
}

body {
    padding: 20px;
    background-image: url('');
    background-repeat: repeat;
}

header {
    background: linear-gradient(to bottom, #f9f9f9, #eaeaea);
    border: 1px solid var(--border-dark);
    border-radius: var(--radius);
    padding: 15px 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
}

header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--primary);
}

header h1 {
    font-size: 22px;
    font-weight: 300;
    color: #1a1a1a;
    letter-spacing: 0.5px;
    text-shadow: 0 1px 0 rgba(255, 255, 255, 0.8);
}

nav {
    display: flex;
    gap: 8px;
    margin-top: 15px;
}

nav button {
    background: linear-gradient(to bottom, #fefefe, #f1f1f1);
    border: 1px solid var(--border-dark);
    border-radius: var(--radius);
    padding: 6px 18px;
    font-size: 13px;
    color: #333;
    cursor: pointer;
    box-shadow: 0 1px 0 rgba(255, 255, 255, 0.8) inset;
    transition: all 0.2s ease;
    position: relative;
    overflow: hidden;
}

nav button:hover {
    background: linear-gradient(to bottom, #f6f6f6, #e8e8e8);
    border-color: #a5a5a5;
}

nav button.active {
    background: linear-gradient(to bottom, #e4f1fa, #d0e5f5);
    border-color: #8bb8e8;
    color: #0066cc;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;
}

nav button.active::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--primary);
}

main {
    max-width: 1000px;
    margin: 0 auto;
    background: var(--white);
    border: 1px solid var(--border-dark);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    background-color: var(--white);
}

article {
    margin-bottom: 20px;
    padding: 20px;
    border: 1px solid var(--border-light);
    border-radius: var(--radius);
    background: var(--white);
    box-shadow: var(--shadow);
    transition: all 0.2s ease;
}

article:hover {
    border-color: var(--border-dark);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.category-label {
    display: inline-block;
    background: linear-gradient(to bottom, #e5f1fb, #d0e5f5);
    color: var(--cat-text);
    padding: 3px 10px;
    margin-bottom: 12px;
    border: 1px solid #b8d8f8;
    border-radius: var(--radius);
    font-size: 12px;
    font-weight: 600;
    text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
    box-shadow: 0 1px 0 rgba(255, 255, 255, 0.8) inset;
}

h2 {
    font-size: 18px;
    margin: 15px 0 10px 0;
    color: #1a1a1a;
    font-weight: 400;
    letter-spacing: 0.2px;
}

.meta {
    color: #666;
    margin-bottom: 15px;
    font-size: 12px;
}

.article-image {
    max-width: 100%;
    border: 1px solid var(--border-light);
    border-radius: var(--radius);
    margin: 15px 0;
    box-shadow: var(--shadow);
}

footer {
    margin-top: 30px;
    padding: 12px;
    text-align: center;
    background: linear-gradient(to bottom, #f9f9f9, #eaeaea);
    border: 1px solid var(--border-dark);
    border-radius: var(--radius);
    color: #555;
    font-size: 12px;
    box-shadow: var(--shadow);
}

/* Windows 7 Form Elements */
select, input, textarea {
    border: 1px solid var(--border-dark);
    border-radius: var(--radius);
    padding: 6px 10px;
    background: var(--white);
    font-family: var(--font-main);
    font-size: 13px;
    box-shadow: 0 1px 0 rgba(255, 255, 255, 0.8) inset;
    transition: all 0.2s ease;
}

select:focus, input:focus, textarea:focus {
    border-color: #8bb8e8;
    box-shadow: 0 0 0 1px #8bb8e8, 0 1px 0 rgba(255, 255, 255, 0.8) inset;
}

button {
    background: linear-gradient(to bottom, #fefefe, #f1f1f1);
    border: 1px solid var(--border-dark);
    border-radius: var(--radius);
    padding: 6px 18px;
    font-size: 13px;
    color: #333;
    cursor: pointer;
    box-shadow: 0 1px 0 rgba(255, 255, 255, 0.8) inset;
    transition: all 0.2s ease;
}

button:hover {
    background: linear-gradient(to bottom, #f6f6f6, #e8e8e8);
    border-color: #a5a5a5;
}

button:active {
    background: linear-gradient(to bottom, #e8e8e8, #f6f6f6);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;
}

.category-filter-bar {
    margin: 20px 0;
    padding: 15px;
    background: linear-gradient(to bottom, #f9f9f9, #f0f0f0);
    border: 1px solid var(--border-dark);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
}

.tab-content {
    padding: 20px 0;
}

.post-form {
    margin: 20px 0;
    padding: 20px;
    background: linear-gradient(to bottom, #f9f9f9, #f0f0f0);
    border: 1px solid var(--border-dark);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
}

.post-form input, .post-form textarea {
    margin-bottom: 15px;
    width: 100%;
    padding: 8px 12px;
}

.post-form button {
    margin-right: 10px;
    margin-top: 10px;
}
textarea {
    min-height: 100%;
    min-width: 50%;
}

/* Aero Glass Effekt f√ºr ausgew√§hlte Elemente */
nav button.active, .category-btn.active {
    background: linear-gradient(to bottom, rgba(229, 241, 250, 0.8), rgba(208, 229, 245, 0.9));
    backdrop-filter: blur(2px);
}

/* Subtile Animationen */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

article {
    animation: fadeIn 0.3s ease-out;
}

    </style>
</head>
<body>
    <h1>Blog Editor</h1>

    <div class="actions">
        <button id="loadData">Daten laden</button>
        <input type="file" id="fileInput" class="file-input" accept=".json">
        <button id="importData">Importieren</button>
        <button id="saveData">Daten speichern</button>
        <button id="generateRSS">RSS generieren</button>
        <button id="addPost">Neuen Post hinzuf√ºgen</button>
    </div>

    <div id="postFormContainer" class="post-form" style="display: none;">
        <h2>Neuen Post erstellen</h2>
        <input type="text" id="postTitle" placeholder="Titel">
        <div class="time-input">
            <input type="text" id="postDate" placeholder="Datum (z.B. 01. Januar 2025)" value="">
            <span>um</span>
            <input type="time" id="postTime" value="12:00">
        </div>
        <input type="text" id="postAuthor" placeholder="Autor" value="n-km">
        <input type="text" id="postCategory" placeholder="Kategorie (z.B. üå± Pflanzen)">
        <input type="text" id="postImage" placeholder="Bild-URL (optional)">
        <textarea id="postText" placeholder="Text (HTML erlaubt)"></textarea>
        <button id="savePost">Post speichern</button>
        <button id="cancelPost">Abbrechen</button>
    </div>

    <div id="postsList" class="posts-list"></div>

    <textarea id="jsonData" placeholder="JSON-Daten werden hier angezeigt..."></textarea>

    <div id="rssPreview" class="preview" style="display: none;">
        <h2>RSS Vorschau</h2>
        <div id="rssContent"></div>
        <button id="downloadRSS">RSS herunterladen</button>
    </div>

    <div id="message"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const jsonData = document.getElementById('jsonData');
            const loadDataBtn = document.getElementById('loadData');
            const importDataBtn = document.getElementById('importData');
            const fileInput = document.getElementById('fileInput');
            const saveDataBtn = document.getElementById('saveData');
            const generateRSSBtn = document.getElementById('generateRSS');
            const addPostBtn = document.getElementById('addPost');
            const postFormContainer = document.getElementById('postFormContainer');
            const savePostBtn = document.getElementById('savePost');
            const cancelPostBtn = document.getElementById('cancelPost');
            const postsList = document.getElementById('postsList');
            const rssPreview = document.getElementById('rssPreview');
            const rssContent = document.getElementById('rssContent');
            const downloadRSSBtn = document.getElementById('downloadRSS');
            const messageDiv = document.getElementById('message');

            const LOCAL_STORAGE_KEY = 'blog_posts_data';
            let currentPosts = [];
            let editingIndex = -1;

            // Initial Daten laden
            function init() {
                // Versuche, Daten aus localStorage zu laden
                const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (savedData) {
                    try {
                        currentPosts = JSON.parse(savedData);
                        jsonData.value = JSON.stringify(currentPosts, null, 2);
                        renderPostsList();
                        showMessage('Daten aus dem Browserspeicher geladen', 'success');
                    } catch (e) {
                        showMessage('Fehler beim Laden der gespeicherten Daten', 'error');
                    }
                }

                // Versuche, data.json zu laden
                loadDataFromFile();
            }

            // Daten aus data.json laden
            function loadDataFromFile() {
                fetch('data.json')
                    .then(response => {
                        if (!response.ok) throw new Error('Datei nicht gefunden');
                        return response.json();
                    })
                    .then(data => {
                        currentPosts = data;
                        jsonData.value = JSON.stringify(data, null, 2);
                        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
                        renderPostsList();
                        showMessage('Daten erfolgreich aus data.json geladen', 'success');
                    })
                    .catch(error => {
                        console.log('data.json nicht gefunden oder Fehler beim Laden:', error);
                    });
            }

            // Daten laden Button
            loadDataBtn.addEventListener('click', loadDataFromFile);

            // Daten importieren
            importDataBtn.addEventListener('click', function() {
                fileInput.click();
            });

            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        currentPosts = data;
                        jsonData.value = JSON.stringify(data, null, 2);
                        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
                        renderPostsList();
                        showMessage('Daten erfolgreich importiert', 'success');
                    } catch (error) {
                        showMessage('Fehler beim Parsen der JSON-Datei: ' + error, 'error');
                    }
                };
                reader.readAsText(file);
            });

            // Daten speichern
            saveDataBtn.addEventListener('click', function() {
                try {
                    const data = JSON.parse(jsonData.value);
                    currentPosts = data;
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));

                    // Erstelle einen Blob mit den Daten
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    // Erstelle einen Download-Link
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'data.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    showMessage('Daten erfolgreich gespeichert und als data.json heruntergeladen', 'success');
                    renderPostsList();
                } catch (error) {
                    showMessage('Fehler beim Parsen der JSON-Daten: ' + error, 'error');
                }
            });

            // RSS generieren
            generateRSSBtn.addEventListener('click', function() {
                try {
                    const data = currentPosts.length > 0 ? currentPosts : JSON.parse(jsonData.value);
                    const rss = generateRSS(data);
                    rssContent.textContent = rss;
                    rssPreview.style.display = 'block';
                    showMessage('RSS erfolgreich generiert', 'success');
                } catch (error) {
                    showMessage('Fehler beim Generieren des RSS-Feeds: ' + error, 'error');
                }
            });

            // RSS herunterladen
            downloadRSSBtn.addEventListener('click', function() {
                const rss = rssContent.textContent;
                const blob = new Blob([rss], { type: 'application/xml' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = 'rss.xml';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showMessage('RSS erfolgreich als rss.xml heruntergeladen', 'success');
            });

            // Post hinzuf√ºgen Formular anzeigen
            addPostBtn.addEventListener('click', function() {
                editingIndex = -1;
                document.getElementById('postTitle').value = '';
                document.getElementById('postDate').value = getCurrentDate();
                document.getElementById('postTime').value = '12:00';
                document.getElementById('postAuthor').value = 'n-km';
                document.getElementById('postCategory').value = '';
                document.getElementById('postImage').value = '';
                document.getElementById('postText').value = '';
                postFormContainer.style.display = 'block';
            });

            // Post speichern
            savePostBtn.addEventListener('click', function() {
                const dateStr = document.getElementById('postDate').value;
                const timeStr = document.getElementById('postTime').value;

                // Kombiniere Datum und Uhrzeit f√ºr RSS
                const rssDate = combineDateTimeForRSS(dateStr, timeStr);

                const post = {
                    title: document.getElementById('postTitle').value,
                    date: dateStr, // Nur das Datum f√ºr die Anzeige
                    rssDate: rssDate, // Vollst√§ndiges Datum+Uhrzeit f√ºr RSS
                    author: document.getElementById('postAuthor').value,
                    category: document.getElementById('postCategory').value,
                    image: document.getElementById('postImage').value,
                    text: document.getElementById('postText').value
                };

                if (!post.title || !post.date || !post.author || !post.category || !post.text) {
                    showMessage('Bitte f√ºllen Sie alle erforderlichen Felder aus', 'error');
                    return;
                }

                if (editingIndex === -1) {
                    currentPosts.unshift(post); // Neuen Post am Anfang einf√ºgen
                } else {
                    currentPosts[editingIndex] = post; // Existierenden Post aktualisieren
                }

                jsonData.value = JSON.stringify(currentPosts, null, 2);
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(currentPosts));
                postFormContainer.style.display = 'none';
                renderPostsList();
                showMessage('Post erfolgreich gespeichert', 'success');
            });

            // Post bearbeiten abbrechen
            cancelPostBtn.addEventListener('click', function() {
                postFormContainer.style.display = 'none';
            });

            // Posts Liste rendern
            function renderPostsList() {
                postsList.innerHTML = '<h2>Posts</h2>';

                if (currentPosts.length === 0) {
                    postsList.innerHTML += '<p>Keine Posts vorhanden</p>';
                    return;
                }

                currentPosts.forEach((post, index) => {
                    const postItem = document.createElement('div');
                    postItem.className = 'post-item';

                    let html = `<h3>${post.title}</h3>`;
                    html += `<p><strong>Datum:</strong> ${post.date}</p>`;
                    html += `<p><strong>Kategorie:</strong> ${post.category}</p>`;
                    if (post.image) {
                        html += `<p><strong>Bild:</strong> ${post.image}</p>`;
                    }
                    html += `<button class="edit-post" data-index="${index}">Bearbeiten</button>`;
                    html += `<button class="delete-post" data-index="${index}">L√∂schen</button>`;

                    postItem.innerHTML = html;
                    postsList.appendChild(postItem);
                });

                // Bearbeiten-Buttons
                document.querySelectorAll('.edit-post').forEach(btn => {
                    btn.addEventListener('click', function() {
                        editingIndex = parseInt(this.dataset.index);
                        const post = currentPosts[editingIndex];

                        document.getElementById('postTitle').value = post.title;
                        document.getElementById('postDate').value = post.date;

                        // Wenn vorhanden, die gespeicherte RSS-Zeit verwenden
                        if (post.rssDate) {
                            const dateObj = new Date(post.rssDate);
                            const hours = String(dateObj.getHours()).padStart(2, '0');
                            const minutes = String(dateObj.getMinutes()).padStart(2, '0');
                            document.getElementById('postTime').value = `${hours}:${minutes}`;
                        } else {
                            document.getElementById('postTime').value = '12:00';
                        }

                        document.getElementById('postAuthor').value = post.author;
                        document.getElementById('postCategory').value = post.category;
                        document.getElementById('postImage').value = post.image || '';
                        document.getElementById('postText').value = post.text;

                        postFormContainer.style.display = 'block';
                    });
                });

                // L√∂schen-Buttons
                document.querySelectorAll('.delete-post').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        if (confirm('M√∂chten Sie diesen Post wirklich l√∂schen?')) {
                            currentPosts.splice(index, 1);
                            jsonData.value = JSON.stringify(currentPosts, null, 2);
                            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(currentPosts));
                            renderPostsList();
                            showMessage('Post erfolgreich gel√∂scht', 'success');
                        }
                    });
                });
            }

            // Kombiniere Datum und Uhrzeit f√ºr RSS
            function combineDateTimeForRSS(dateStr, timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                const m = dateStr.match(/(\d{2})\. (\w+) (\d{4})/);

                if (m) {
                    const months = {
                        "Januar": "01","Februar": "02","M√§rz": "03","April": "04","Mai": "05","Juni": "06",
                        "Juli": "07","August": "08","September": "09","Oktober": "10","November": "11","Dezember": "12"
                    };
                    const [_, day, monthName, year] = m;
                    const month = months[monthName] || "01";

                    // Erstelle ein Date-Objekt mit der lokalen Zeit
                    const date = new Date(`${year}-${month}-${day}T${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:00`);

                    // Konvertiere in UTC und gib RFC822-String zur√ºck
                    return date.toUTCString();
                }

                return new Date().toUTCString();
            }

            // RSS generieren Funktion
            function generateRSS(posts) {
                function escapeXml(str) {
                    return (str || "")
                        .replace(/&/g, "&amp;")
                        .replace(/</g, "&lt;")
                        .replace(/>/g, "&gt;")
                        .replace(/"/g, "&quot;")
                        .replace(/'/g, "&apos;");
                }

                const items = posts.map(post => {
                    if (!post.title) return '';

                    // Verwende rssDate falls vorhanden, sonst versuche das Datum zu parsen
                    const pubDate = post.rssDate || dateToRFC822(post.date);

                    return `
                        <item>
                            <title>${escapeXml(post.title)}</title>
                            <link>https://n-km.github.io/blog/#${encodeURIComponent(post.title.replace(/\s+/g, '-').toLowerCase())}</link>
                            <description><![CDATA[${post.text || ""}${post.image ? `<br><img src="${post.image}">` : ""}]]></description>
                            <pubDate>${pubDate}</pubDate>
                            <category>${escapeXml(post.category.replace(/[üêùüå±üì¢]/g, '').trim() || "")}</category>
                            <author>${escapeXml(post.author || "")}</author>
                        </item>
                    `.trim();
                }).join('\n');

                return `<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
  <channel>
    <title>Minimal Blog | n-km</title>
    <link>https://n-km.github.io/blog/</link>
    <description>RSS-Feed aus data.json</description>
    <language>de-de</language>
    <generator>generate-rss.js</generator>
    <lastBuildDate>${new Date().toUTCString()}</lastBuildDate>
    ${items}
  </channel>
</rss>`;
            }

            // Hilfsfunktion f√ºr Datumskonvertierung (f√ºr bestehende Posts)
            function dateToRFC822(d) {
                if (!d) return new Date().toUTCString();
                const m = d.match(/(\d{2})\. (\w+) (\d{4})/);
                if (m) {
                    const months = {
                        "Januar": "01","Februar": "02","M√§rz": "03","April": "04","Mai": "05","Juni": "06",
                        "Juli": "07","August": "08","September": "09","Oktober": "10","November": "11","Dezember": "12"
                    };
                    const [_, day, monthName, year] = m;
                    const month = months[monthName] || "01";
                    return new Date(`${year}-${month}-${day}T12:00:00+02:00`).toUTCString();
                }
                return new Date(d).toUTCString();
            }

            // Aktuelles Datum im deutschen Format
            function getCurrentDate() {
                const now = new Date();
                const months = [
                    "Januar", "Februar", "M√§rz", "April", "Mai", "Juni",
                    "Juli", "August", "September", "Oktober", "November", "Dezember"
                ];
                const day = now.getDate().toString().padStart(2, '0');
                const month = months[now.getMonth()];
                const year = now.getFullYear();
                return `${day}. ${month} ${year}`;
            }

            // Nachricht anzeigen
            function showMessage(msg, type) {
                messageDiv.textContent = msg;
                messageDiv.className = type;
                setTimeout(() => {
                    messageDiv.textContent = '';
                    messageDiv.className = '';
                }, 3000);
            }

            // Initialisierung
            init();
        });
    </script>
</body>
</html>
